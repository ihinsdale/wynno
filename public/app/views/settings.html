<div class="row">
  <div class="col-md-8 col-md-offset-2 text-center">
    <h2>Your filters</h2>
  </div>
</div>
<div class="row" ng-repeat="filter in activeFilters | reverse">
  <div class="col-md-8 col-md-offset-2">
    <button class="removeSetting" ng-click="disableFilter($index)">
      <span class="icomoon-cancel-circle"></span>
    </button>
    {{filter}}
  </div>
</div>
<div>Filter Suggestions</div>
<div class="row" ng-repeat="filter in suggestedFilters | reverse">
  <button type="button" class="btn btn-default" ng-click="adoptSugg($index)">Adopt</button>
  <div class="col-md-8 col-md-offset-2">
    {{filter}}
  </div>
  <button type="button" class="btn btn-default" ng-click="dismissSugg($index)">Dismiss</button>
</div>
<div>Dismissed Suggestions</div>
<div class="row" ng-repeat="filter in dismissedFilters | reverse">
  <div class="col-md-8 col-md-offset-2">
    {{filter}}
  </div>
</div>

<div class="row">
  <div class="col-xs-12 col-md-1 col-md-offset-1">
    <h3>How</h3>
    <div class="btn-group">
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" ng-init="draftFilter.typeDisplayed = 'Hear/Mute'" ng-class="{hear:draftFilter.type == 'hear', mute:draftFilter.type=='mute'}">
        <span ng-bind="draftFilter.typeDisplayed"></span>
        <span class="caret" ng-class="{white: draftFilter.type == 'hear' || draftFilter.type == 'mute'}"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
        <li><a href="" ng-click="draftFilter.type = 'hear'; draftFilter.typeDisplayed = 'Hear'" class="ayeGreen">Hear</a></li>
        <li><a href="" ng-click="draftFilter.type = 'mute'; draftFilter.typeDisplayed = 'Mute'" class="nayRed">Mute</a></li>
      </ul>
    </div>
  </div>
  <div class="col-xs-12 col-md-2">
    <h3>Who</h3>
    <div class="btn-group">
      <button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" ng-init="draftFilter.usersDisplayed = 'all users (default)'">
        <span ng-bind="draftFilter.usersDisplayed"></span>
        <span class="caret"></span>
      </button>
      <ul class="dropdown-menu" role="menu">
        <li ng-repeat="user in draftFilter.users">
          <button class="removeSetting" ng-click="draftFilterRemoveUser($index)">
            <span class="icomoon-cancel-circle"></span>
          </button>
          <span class="user conditionSideBorder">@{{user}}</span>
        </li>
      </ul>
    </div>
    <div class="input-group">
      <span class="input-group-addon">@</span>
      <input class="form-control" id="prependedInput" type="text" placeholder="Enter a username" ng-model="draftFilter.usernameInput" ng-minlength="1">
      <span class="input-group-btn">
        <button class="btn btn-primary" ng-click="draftFilterAddUser(draftFilter.usernameInput)" value="Add">Add</button>
      </span>
    </div>
  </div>
  <div class="col-md-6">
    <h3>What</h3>
  </div>
</div>

<div class="row">
  <div class="col-md-8 col-md-offset-2">
    <hr>
    <div class="text-center">
      <button class="btn btn-default btn-lg addNewFilter" ng-click="newDraftFilter()">Add new filter</button>
    </div>
    <div collapse="builderIsCollapsed">
      <div class="well well-lg">
        <accordion close-others="true" >
          <accordion-group is-open="step1.isOpen">
            <accordion-heading>
              <div>
                1. Hear/Mute
                <span class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': step1.isOpen, 'glyphicon-chevron-right': !step1.isOpen}"></span>
                <span class="pull-right glyphicon glyphicon-ok okGreen stepStatus" ng-show="!!draftFilter.type"></span>
                <span class="pull-right glyphicon glyphicon-remove notOkRed stepStatus" ng-show="invalidForSaving.type && !draftFilter.type"></span>
              </div>
            </accordion-heading>
            <div class="btn-group">
              <button type="button" class="btn btn-default hear" ng-model="draftFilter.type" btn-radio="'hear'">Hear</button>
              <button type="button" class="btn btn-default mute" ng-model="draftFilter.type" btn-radio="'mute'">Mute</button>
            </div>
          </accordion-group>
          <accordion-group is-open="step2.isOpen">
            <accordion-heading>
              <div>
                2. Who
                <span class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': step2.isOpen, 'glyphicon-chevron-right': !step2.isOpen}"></span>
                <span class="pull-right glyphicon glyphicon-ok okGreen stepStatus" ng-show="draftFilter.users.length > 0 || hasValidCondition()"></span>
                <span class="pull-right glyphicon glyphicon-remove notOkRed stepStatus" ng-show="invalidForSaving.users && draftFilter.users.length == 0 && !hasValidCondition()"></span>
              </div>
            </accordion-heading>
            <div class="row listOfUsers" ng-show="!draftFilter.users.length">
              <div class="col-md-11 col-md-offset-1">
                  <div class="conditionSideBorder">(all users - default)</div>
              </div>
            </div>
            <div class="row listOfUsers" ng-repeat="user in draftFilter.users">
              <div class="row">
                <div class="col-md-11 col-md-offset-1">
                  <div class="andCondition" ng-show="!$first">or</div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <button class="removeSetting" ng-click="draftFilterRemoveUser($index)">
                    <span class="icomoon-cancel-circle"></span>
                  </button>
                  <span class="user conditionSideBorder">@{{user}}</span>
                </div>
              </div>
            </div>
            <div class="row" ng-show="!!errorAddingUser">
              <div class="col-md-12">
                <div class="alert alert-danger alert-dismissable">
                  <button type="button" class="close" data-dismiss="alert" aria-hidden="true" ng-click="dismissAlert('errorAddingUser')">&times;</button>
                  <strong>{{errorAddingUser}}</strong>
                </div>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12 col-xs-12">
                <div class="input-group">
                  <span class="input-group-addon">@</span>
                  <input class="form-control" id="prependedInput" type="text" placeholder="Enter a username" ng-model="draftFilter.usernameInput" ng-minlength="1">
                  <span class="input-group-btn">
                    <button class="btn btn-primary" ng-click="draftFilterAddUser(draftFilter.usernameInput)" value="Add">Add</button>
                  </span>
                </div>
              </div>
            </div>
          </accordion-group>
          <accordion-group is-open="step3.isOpen">
            <accordion-heading>
              <div>
                3. What
                <span class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': step3.isOpen, 'glyphicon-chevron-right': !step3.isOpen}"></span>
                <span class="pull-right glyphicon glyphicon-ok okGreen stepStatus" ng-show="(draftFilter.users.length > 0 || hasValidCondition()) && !hasInvalidCondition()"></span>
                <span class="pull-right glyphicon glyphicon-remove notOkRed stepStatus" ng-show="(invalidForSaving.conditions && draftFilter.users.length == 0 && !hasValidCondition()) || hasInvalidCondition()"></span>
              </div>
            </accordion-heading>
            <label>Select the conditions tweets must match</label>
            <div class="" ng-repeat="condition in draftFilter.conditions">
              <div class="row">
                <div class="col-md-11 col-md-offset-1">
                  <div class="andCondition" ng-show="!$first">and</div>
                </div>
              </div>
              <div class="row">
                <div class="col-md-12">
                  <button class="removeSetting" ng-click="removeCondition($index)" ng-show="!!condition.type">
                    <span class="icomoon-cancel-circle"></span>
                  </button>
                  <div class="conditionSideBorder">
                    <select class="form-control conditionSelectorWidth" ng-model="condition.type">
                      <option value="link">a link to:</option>
                      <option value="word">the word or phrase:</option>
                      <option value="hashtag">the hashtag:</option>
                      <option value="picture">a picture</option>
                      <option value="quotation">a quotation</option>
                    </select>
                    <div class="row conditionInputPaddingTop">
                      <div ng-show="condition.type == 'link'">
                        <div class="col-xs-11 col-xs-offset-1 col-md-11 col-md-offset-1">
                          <input type="text" class="form-control" placeholder="(any domain)" ng-model="condition.link">
                        </div>
                      </div>
                      <div ng-show="condition.type == 'word'">
                        <div class="col-xs-11 col-xs-offset-1 col-md-11 col-md-offset-1">
                          <input type="text" class="form-control" placeholder="Enter a word or phrase" ng-model="condition.word">
                        </div>
                        <div>TODO: add checkbox for case sensitivity</div>
                      </div>
                      <div ng-show="condition.type == 'hashtag'">
                        <div class="col-xs-11 col-xs-offset-1 col-md-11 col-md-offset-1">
                          <div class="input-group">
                            <span class="input-group-addon">#</span>
                            <input type="text" class="form-control" placeholder="(any hashtag)" ng-model="condition.hashtag">
                          </div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>
            <div class="row addConditionRow">
              <div class="col-xs-12 col-md-12">
                <button type-"button" class="btn btn-primary addCondition" ng-click="addAnotherCondition()">
                  <span class="icomoon-plus plus"></span>Add another
                </button>
              </div>
            </div>
          </accordion-group>
          <accordion-group is-open="step4.isOpen">
            <accordion-heading>
              <div>
                Options
                <span class="pull-right glyphicon" ng-class="{'glyphicon-chevron-down': step4.isOpen, 'glyphicon-chevron-right': !step4.isOpen}"></span>
                <span class="pull-right glyphicon glyphicon-ok okGreen stepStatus" ng-show="!!draftFilter.scope"></span>
                <span class="pull-right glyphicon glyphicon-remove notOkRed stepStatus" ng-show="!draftFilter.scope"></span>
              </div>
            </accordion-heading>
            <div>Apply this filter to:</div>
            <div class="btn-group-vertical visible-xs">
              <button type="button" class="btn btn-default toggledPurple" ng-model="draftFilter.scope" btn-radio="'all'">Tweets + Retweets</button>
              <button type="button" class="btn btn-default toggledPurple" ng-model="draftFilter.scope" btn-radio="'tweets'">Tweets only</button>
              <button type="button" class="btn btn-default toggledPurple" ng-model="draftFilter.scope" btn-radio="'retweets'">Retweets only</button>
            </div>
            <div class="btn-group hidden-xs">
              <button type="button" class="btn btn-default toggledPurple" ng-model="draftFilter.scope" btn-radio="'all'">Tweets + Retweets</button>
              <button type="button" class="btn btn-default toggledPurple" ng-model="draftFilter.scope" btn-radio="'tweets'">Tweets only</button>
              <button type="button" class="btn btn-default toggledPurple" ng-model="draftFilter.scope" btn-radio="'retweets'">Retweets only</button>
            </div>
          </accordion-group>
        </accordion>
        <div class="row paddingTop40">
          <div class="col-md-12 text-center">
            <button type="button" class="btn btn-primary btn-lg btn-block saveFilter" ng-click="saveFilter(draftFilter)">Save filter</button>
          </div>
        </div>
      </div> 
    </div>
  </div>
</div>
